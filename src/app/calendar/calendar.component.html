<div class="container-calendar" style="margin-top: 5em;">
<div class="calendar-wrapper">
  <div class="calendar-header">
    <h1>Demandes Calendar</h1>
    <div class="calendar-header-actions">
      <button class="calendar-header-button" (click)="createNewDemande()">
        <i class="icon-add"></i>
        New Demande
      </button>
      <button class="calendar-header-button calendar-header-button-primary" (click)="filterEvents()">
        <i class="icon-filter"></i>
        Apply Filters
      </button>
    </div>
  </div>

  <div class="calendar-view-controls">
    <button class="calendar-view-button" [class.active]="currentView === 'dayGridMonth'" (click)="changeView('dayGridMonth')">Month</button>
    <button class="calendar-view-button" [class.active]="currentView === 'dayGridWeek'" (click)="changeView('dayGridWeek')">Week</button>
    <button class="calendar-view-button" [class.active]="currentView === 'dayGridDay'" (click)="changeView('dayGridDay')">Day</button>
    <button class="calendar-view-button" [class.active]="currentView === 'listWeek'" (click)="changeView('listWeek')">List</button>
  </div>

  <div class="calendar-filters">
    <div class="calendar-filter-group">
      <label class="calendar-filter-label">Status</label>
      <select class="calendar-filter-select" [(ngModel)]="selectedStatus" (ngModelChange)="filterByEmployeAndStatut()">
        <option value="all">All Statuses</option>
        <option value="pending">Pending</option>
        <option value="in_progress">In Progress</option>
        <option value="completed">Completed</option>
        <option value="rejected">Rejected</option>
      </select>
    </div>
    
    <div class="calendar-filter-group">
      <label class="calendar-filter-label">Type</label>
      <select class="calendar-filter-select" [(ngModel)]="selectedType" (ngModelChange)="filterByTypeDemande()">
        <option value="all">All Types</option>
        <option value="congÃ©">CongÃ©</option>
        <option value="formation">Formation</option>
        <option value="Ã©quipement">Ã‰quipement</option>
        <option value="autre">Autre</option>
      </select>
    </div>
    
    <div class="calendar-filter-group">
      <label class="calendar-filter-label">Date Range</label>
      <select class="calendar-filter-select" [(ngModel)]="selectedDateRange" (ngModelChange)="filterByDateRange()">
        <option *ngFor="let range of dateRanges" [value]="range.value">{{ range.label }}</option>
      </select>
    </div>
  </div>

  <div class="calendar-legend">
    <div class="calendar-legend-item">
      <div class="calendar-legend-color legend-color-pending"></div>
      <span>Pending</span>
    </div>
    <div class="calendar-legend-item">
      <div class="calendar-legend-color legend-color-inprogress"></div>
      <span>In Progress</span>
    </div>
    <div class="calendar-legend-item">
      <div class="calendar-legend-color legend-color-completed"></div>
      <span>Completed</span>
    </div>
    <div class="calendar-legend-item">
      <div class="calendar-legend-color legend-color-rejected"></div>
      <span>Rejected</span>
    </div>
  </div>

  <div class="calendar-search">
    <i class="calendar-search-icon icon-search"></i>
    <input type="text" class="calendar-search-input" placeholder="Search demandes by matricule..." 
           [(ngModel)]="searchQuery" (ngModelChange)="handleSearch()">
  </div>

  <div *ngIf="loading" class="calendar-loading">
    <div class="calendar-loading-spinner"></div>
  </div>

  <div *ngIf="!loading && filteredDemandes.length === 0" class="calendar-empty">
    <div class="calendar-empty-icon">ðŸ“…</div>
    <h3 class="calendar-empty-title">No demandes found</h3>
    <p class="calendar-empty-description">You don't have any demandes. Create a new demande or check your filters.</p>
    <button class="calendar-header-button calendar-header-button-primary" (click)="createNewDemande()">
      <i class="icon-add"></i>
      Create Demande
    </button>
  </div>

  <full-calendar *ngIf="calendarOptions && filteredDemandes.length > 0" [options]="calendarOptions"></full-calendar>

  <div class="calendar-stats" *ngIf="filteredDemandes.length > 0">
    <div class="calendar-stat-item calendar-stat-pending">
      <div class="calendar-stat-value">{{ getDemandesByStatus('pending').length }}</div>
      <div class="calendar-stat-label">Pending</div>
    </div>
    <div class="calendar-stat-item calendar-stat-inprogress">
      <div class="calendar-stat-value">{{ getDemandesByStatus('in_progress').length }}</div>
      <div class="calendar-stat-label">In Progress</div>
    </div>
    <div class="calendar-stat-item calendar-stat-completed">
      <div class="calendar-stat-value">{{ getDemandesByStatus('completed').length }}</div>
      <div class="calendar-stat-label">Completed</div>
    </div>
    <div class="calendar-stat-item">
      <div class="calendar-stat-value">{{ filteredDemandes.length }}</div>
      <div class="calendar-stat-label">Total</div>
    </div>
  </div>

  <div class="calendar-event-modal" [class.active]="showEventModal">
    <div class="calendar-event-modal-content">
      <div class="calendar-event-modal-header">
        <h2 class="calendar-event-modal-title">Demande Details</h2>
        <button class="calendar-event-modal-close" (click)="closeEventModal()">Ã—</button>
      </div>
      <div class="calendar-event-modal-body" *ngIf="selectedEvent">
        <div class="calendar-event-detail">
          <div class="calendar-event-detail-label">Title</div>
          <div class="calendar-event-detail-value">{{ selectedEvent.title }}</div>
        </div>
        <div class="calendar-event-detail">
          <div class="calendar-event-detail-label">Status</div>
          <div class="calendar-event-detail-value">
            <span class="status-indicator" [class]="'status-' + getStatusClass(selectedEvent.status)"></span>
            {{ selectedEvent.status }}
          </div>
        </div>
        <div class="calendar-event-detail">
          <div class="calendar-event-detail-label">Type</div>
          <div class="calendar-event-detail-value">{{ selectedEvent.type || 'No Type' }}</div>
        </div>
        <div class="calendar-event-detail" *ngIf="selectedEvent.employe">
          <div class="calendar-event-detail-label">Employee Matricule</div>
          <div class="calendar-event-detail-value">{{ selectedEvent.employe?.matricule || 'Unknown' }}</div>
        </div>
        <div class="calendar-event-detail">
          <div class="calendar-event-detail-label">Creation Date</div>
          <div class="calendar-event-detail-value">{{ selectedEvent.dateCreation | date:'mediumDate' }}</div>
        </div>
      </div>
      <div class="calendar-event-modal-footer">
        <button class="calendar-event-modal-button calendar-event-modal-button-secondary" (click)="closeEventModal()">Close</button>
        <button class="calendar-event-modal-button calendar-event-modal-button-primary">Edit</button>
      </div>
    </div>
  </div>
</div>
</div>