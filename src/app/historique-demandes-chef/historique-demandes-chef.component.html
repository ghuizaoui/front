<!-- historique-demandes.component.html -->
<div class="historique-container" style="margin-top: 10em;">
    <div class="card">
      <div class="card-header">
        <h1 class="card-title">üìã Historique des Demandes</h1>
        <p class="card-subtitle">Consultez l'historique complet de toutes vos demandes</p>
      </div>
  
      <div class="card-body">
        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-state">
          <div class="spinner"></div>
          <p>Chargement des demandes...</p>
        </div>
  
        <!-- Error Message -->
        <div *ngIf="errorMessage" class="error-message">
          <span class="error-icon">‚ö†Ô∏è</span>
          {{ errorMessage }}
          <button (click)="loadDemandes()" class="retry-btn">R√©essayer</button>
        </div>
  
        <!-- Filters Section -->
        <div *ngIf="!isLoading" class="filters-section">
          <div class="filter-row">
            <div class="filter-group">
              <label>üîç Recherche</label>
              <input type="text" [(ngModel)]="searchText" (input)="applyFilters()" 
                     placeholder="Rechercher par ID, nom, type..." class="form-control">
            </div>
  
            <div class="filter-group">
              <label>üìÇ Cat√©gorie</label>
              <select [(ngModel)]="selectedCategory" (change)="applyFilters()" class="form-select">
                <option *ngFor="let cat of categories" [value]="cat.value">{{ cat.label }}</option>
              </select>
            </div>
  
            <div class="filter-group">
              <label>üìä Statut</label>
              <select [(ngModel)]="selectedStatus" (change)="applyFilters()" class="form-select">
                <option *ngFor="let status of statuses" [value]="status.value">{{ status.label }}</option>
              </select>
            </div>
          </div>
  
          <div class="filter-row">
            <div class="filter-group">
              <label>üìÖ P√©riode</label>
              <select [(ngModel)]="dateRange" (change)="applyFilters()" class="form-select">
                <option *ngFor="let range of dateRanges" [value]="range.value">{{ range.label }}</option>
              </select>
            </div>
  
            <div *ngIf="dateRange === 'custom'" class="filter-group custom-dates">
              <label>Du</label>
              <input type="date" [(ngModel)]="startDate" (change)="applyFilters()" class="form-control">
              <label>Au</label>
              <input type="date" [(ngModel)]="endDate" (change)="applyFilters()" class="form-control">
            </div>
  
            <div class="filter-actions">
              <button (click)="clearFilters()" class="btn btn-secondary">
                üóëÔ∏è Effacer les filtres
              </button>
              <span class="results-count">{{ filteredDemandes.length }} r√©sultat(s)</span>
            </div>
          </div>
        </div>
  
        <!-- Tabs Navigation -->
        <div *ngIf="!isLoading && !errorMessage" class="tabs-navigation">
          <button [class.active]="activeTab === 'all'" (click)="activeTab = 'all'" class="tab-btn">
            üìã Toutes les demandes ({{ filteredDemandes.length }})
          </button>
          <button [class.active]="activeTab === 'validated'" (click)="activeTab = 'validated'" class="tab-btn">
            ‚úÖ Valid√©es ({{ validatedDemandes.length }})
          </button>
          <button [class.active]="activeTab === 'refused'" (click)="activeTab = 'refused'" class="tab-btn">
            ‚ùå Refus√©es ({{ refusedDemandes.length }})
          </button>
        </div>
  
        <!-- All Demands Table -->
        <div *ngIf="!isLoading && !errorMessage && activeTab === 'all'" class="table-section">
          <div class="table-container">
            <table class="demandes-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Employ√©</th>
                  <th>Type</th>
                  <th>P√©riode</th>
                  <th>Date cr√©ation</th>
                  <th>Statut</th>
                  <th>D√©tails</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let demande of filteredDemandes" [class]="getStatusClass(demande.statut)">
                  <td class="demande-id">#{{ demande.id }}</td>
                  <td class="employe-info">
                    <span class="employe-name">{{ demande.employe?.prenom }} {{ demande.employe?.nom }}</span>
                    <span class="employe-matricule">{{ demande.employe?.matricule }}</span>
                  </td>
                  <td class="demande-type">{{ getCategoryLabel(demande.categorie) }}</td>
                  <td class="demande-period">{{ getDemandePeriod(demande) }}</td>
                  <td class="demande-date">{{ formatDateTime(demande.dateCreation) }}</td>
                  <td class="demande-status">
                    <span class="status-badge">{{ STATUT_LABELS[demande.statut] }}</span>
                  </td>
                  <td class="demande-details">{{ getDemandeDetails(demande) }}</td>
                </tr>
              </tbody>
            </table>
            
            <div *ngIf="filteredDemandes.length === 0" class="empty-state">
              <div class="empty-icon">üì≠</div>
              <h3>Aucune demande trouv√©e</h3>
              <p>Aucune demande ne correspond √† vos crit√®res de recherche.</p>
            </div>
          </div>
        </div>
  
        <!-- Validated Demands Table -->
        <div *ngIf="!isLoading && !errorMessage && activeTab === 'validated'" class="table-section">
          <div class="table-container">
            <table class="demandes-table validated-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Employ√©</th>
                  <th>Type</th>
                  <th>P√©riode</th>
                  <th>Date validation</th>
                  <th>Validateur</th>
                  <th>D√©tails</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let demande of validatedDemandes" class="status-validated">
                  <td class="demande-id">#{{ demande.id }}</td>
                  <td class="employe-info">
                    <span class="employe-name">{{ demande.employe?.prenom }} {{ demande.employe?.nom }}</span>
                    <span class="employe-matricule">{{ demande.employe?.matricule }}</span>
                  </td>
                  <td class="demande-type">{{ getCategoryLabel(demande.categorie) }}</td>
                  <td class="demande-period">{{ getDemandePeriod(demande) }}</td>
                  <td class="demande-date">{{ formatDateTime(demande.dateValidation) }}</td>
                  <td class="validateur-info">
                    <span *ngIf="demande.validateur">{{ demande.validateur.prenom }} {{ demande.validateur.nom }}</span>
                    <span *ngIf="!demande.validateur">Syst√®me</span>
                  </td>
                  <td class="demande-details">{{ getDemandeDetails(demande) }}</td>
                </tr>
              </tbody>
            </table>
            
            <div *ngIf="validatedDemandes.length === 0" class="empty-state">
              <div class="empty-icon">‚úÖ</div>
              <h3>Aucune demande valid√©e</h3>
              <p>Aucune demande valid√©e ne correspond √† vos crit√®res de recherche.</p>
            </div>
          </div>
        </div>
  
        <!-- Refused Demands Table -->
        <div *ngIf="!isLoading && !errorMessage && activeTab === 'refused'" class="table-section">
          <div class="table-container">
            <table class="demandes-table refused-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Employ√©</th>
                  <th>Type</th>
                  <th>P√©riode</th>
                  <th>Date refus</th>
                  <th>Motif</th>
                  <th>Validateur</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let demande of refusedDemandes" class="status-refused">
                  <td class="demande-id">#{{ demande.id }}</td>
                  <td class="employe-info">
                    <span class="employe-name">{{ demande.employe?.prenom }} {{ demande.employe?.nom }}</span>
                    <span class="employe-matricule">{{ demande.employe?.matricule }}</span>
                  </td>
                  <td class="demande-type">{{ getCategoryLabel(demande.categorie) }}</td>
                  <td class="demande-period">{{ getDemandePeriod(demande) }}</td>
                  <td class="demande-date">{{ formatDateTime(demande.dateValidation) }}</td>
                  <td class="refusal-reason">
                    <span class="reason-text">{{ demande.commentaireRefus || 'Aucun motif sp√©cifi√©' }}</span>
                  </td>
                  <td class="validateur-info">
                    <span *ngIf="demande.validateur">{{ demande.validateur.prenom }} {{ demande.validateur.nom }}</span>
                    <span *ngIf="!demande.validateur">Syst√®me</span>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <div *ngIf="refusedDemandes.length === 0" class="empty-state">
              <div class="empty-icon">‚ùå</div>
              <h3>Aucune demande refus√©e</h3>
              <p>Aucune demande refus√©e ne correspond √† vos crit√®res de recherche.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>